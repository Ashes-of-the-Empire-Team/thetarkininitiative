clear_side_guild_screen_flags = {
	if = {
		limit = {
			has_country_flag = bounty_hunter_side_screen
		}
		clr_country_flag = bounty_hunter_side_screen
	}else_if = {
		limit = {
			has_country_flag = smugglers_side_screen
		}
		clr_country_flag = smugglers_side_screen	
	}else_if = {
		limit = {
			has_country_flag = technicians_side_screen
		}
		clr_country_flag = technicians_side_screen	
	}else_if = {
		limit = {
			has_country_flag = spynet_side_screen
		}
		clr_country_flag = spynet_side_screen	
	}else_if = {
		limit = {
			has_country_flag = counter_intelligence_side_screen
		}
		clr_country_flag = counter_intelligence_side_screen	
	}
		
}
find_espionage_mission_end_time = {

}
espionage_end_mission_effect = {
	## DO NOT CHANGE THIS WITHOUT PRIOR NOTIFICATION TO NEVERFIRE, ONLY ADD STUFF AT ADD MODIFIERS FOR SUCCESS CHANCE
	meta_effect = { # GRABING THE AGENT VARIABLES
		text = {
			set_temp_variable = {agent_name = agent_name_slot_[WHAT_SLOT_IT_IS] }
			set_temp_variable = {agent_charisma = agent_charisma_slot_[WHAT_SLOT_IT_IS] }
			set_temp_variable = {agent_intelligence = agent_intelligence_slot_[WHAT_SLOT_IT_IS] }
			set_temp_variable = {agent_martial = agent_martial_slot_[WHAT_SLOT_IT_IS] }
			set_temp_variable = {agent_personality_trait = personality_trait_slot_[WHAT_SLOT_IT_IS] }
			set_temp_variable = {agent_class_trait = class_trait_slot_[WHAT_SLOT_IT_IS] }
			set_temp_variable = {agent_race_trait = race_trait_slot_[WHAT_SLOT_IT_IS] }
			set_temp_variable = {agent_expertise = expertise_slot_[WHAT_SLOT_IT_IS] }
			set_temp_variable = {agent_expertise_progress = expertise_progress_slot_[WHAT_SLOT_IT_IS] }
		}
			WHAT_SLOT_IT_IS = "[?agent_slot_number]"
	}
## ADD MODIFIERS FOR SUCCESS CHANCE HERE
	set_temp_variable = {Total_counterespionage_vs_espionage_percentage = modifier@espionage_value } ## grab espionage value (the good for you one)
	targeted_country = {
		subtract_from_temp_variable = {Total_counterespionage_vs_espionage_percentage = modifier@counter_espionage_value} ## grab opponetnts counter espionage value (bad for you)
	}
	## GRABBING TRAIT MODIFIERS
	add_ideas = {
		agent_class_trait
		agent_race_trait
		agent_personality_trait
	}
	meta_effect = { ### Grabbing specfic mission success chance from traits
		text = {
			add_to_temp_variable = {Total_counterespionage_vs_espionage_percentage = modifier@[MISSION_NAME]_success_chance} 
		}
			MISSION_NAME = "[?effect_mission_identifier.GetTokenKey]"
	}
	set_temp_variable = {critical_success_chance = 10}
	add_to_temp_variable = {critical_success_chance = modifier@espionage_critical_success_chance}
	set_temp_variable = {critical_faliure_chance = 90}
	add_to_temp_variable = {critical_faliure_chance = modifier@espionage_critical_faliure_chance} ## THIS WILL BE NEGATIVE (if you want the chance of critical failure to be lower)
	add_to_temp_variable = {agent_charisma = modifier@espionage_charisma_score_bonuses}
	add_to_temp_variable = {agent_martial = modifier@espionage_martial_score_bonuses}
	add_to_temp_variable = {agent_intelligence = modifier@espionage_intelligence_score_bonuses}
	add_to_temp_variable = {Total_counterespionage_vs_espionage_percentage = agent_expertise}
	add_to_temp_variable = {Total_counterespionage_vs_espionage_percentage = modifier@espionage_faliure_chance}
	add_to_temp_variable = {Total_counterespionage_vs_espionage_percentage = modifier@espionage_success_chance}
## END OF MODIFIERS
	randomize_temp_variable = {  ## success and failure chance generator
		var = chance_of_success 
		distribution = uniform
		min = 1
		max = 100
	}

	## ABOVE IS GRABBING THE CORRECT AGENTS VARIABLES
	meta_effect = { # grab the mission identifier and enact that scripted effect, each scripted effects holds the end results of a operation
		text = {
			[MISSION_NAME]_mission_end_effect = yes
		}
			MISSION_NAME = "[?effect_mission_identifier.GetTokenKey]"
	}

	remove_ideas = {
		agent_class_trait
		agent_race_trait
		agent_personality_trait
	}
}

## EXAMPLE END EFFECT
example_end_effect = {

		## HOW THE CHANCE OF SUCCESS WORKS
	# Chance of success is a random number between 1 and 100
	# You want that number to fall within your 'net', which is the sum total of positive and negative modifiers and skill scores
	# multiplied by how easy the mission is (lower numbers are harder as your net is smaller)

		## FOR EXAMPLE
	#	martial score is 12
	#	technician score is 7
	#	total skill score divided by two = 9.5 (reason is there are two skills while some missions use only one)
	#   mission is 6 on the factor of how hard it is
	#   net is then 57
	#   times by 1.10, which is the sum total of the percentages for epsionage and counter espionage
	#	so net becomes 62.7
	#	chance_of_success lands on 62
		##
	## 
		set_temp_variable = { net_size = agent_martial } ## find characters martial and sets net_size to then work out success chance
		add_to_temp_variable = { net_size = agent_charisma } ## find characters charisma and adds to net_size to then work out success chance
		add_to_temp_variable = { net_size = agent_intelligence } ## find characters intelligence and adds to net_size to then work out success chance
		divide_temp_variable = { net_size = 3 } ## Getting the average points between agents (3 skill scores being used so divide by 3)
	# ALL OF ABOVE DECIDES WHICH POINTS TO USE

		multiply_temp_variable = { net_size = 6 } ## 6 on how easy it is
		multiply_temp_variable = { net_size = Total_counterespionage_vs_espionage_percentage} ## multiply the bonuses to get total net size




		### THIS BIT IS THE END RESULT, IT DECIDES THE EVENTS AND EFFECTS. 
	## ALWAYS USE THIS SETUP
	## PUTS IN CORRECT TRIGGERS
	## EVENTS ARE GENERALISED EVENTS, WILL PUT IN LISTED REWARDS FROM LOCALISATION AND LAST PHASE 

	if = {
		limit = {
			check_variable = {
				var = chance_of_success
				value = net_size
				compare = greater_than_or_equals
			}
		}
		if = {
			limit = {
				check_variable = {chance_of_success > critical_success_chance} ## If the success chance is over critical success chance (normally 10) (chance rolled didnt roll low} act the nromal effects
			}
			var:targeted_country = {
				## EFFECTS ON THE TARGETED COUNTRY
				country_event = espionage_missions.5 ## ESPIOANGE MISSION WAS SUCCESSFUL ON YOUR COUNTRY
			}
			country_event = espionage_missions.1 ## SUCCESS MISSION EVENT
		}else = { ### CRITICAL SUCCESSS EFFECTS
			var:targeted_country = {
				## CRITICAL SUCCESSS EFFECTS ON TARGET COUNTRY
				country_event = espionage_missions.6 ## ESPIOANGE CRITICAL SUCCESS WAS SUCCESSFUL ON YOUR COUNTRY
			}
			country_event = espionage_missions.2 ## CRITICAL SUCCESS EVENT
		}
	}else = {## FALIURE
		if = {
			limit = {
				check_variable = {chance_of_success < critical_faliure_chance} ## If the success chance is under critical faliure chance (normally 90) (mission wasnt critical failure)
			}
			var:targeted_country = {
				country_event = espionage_missions.7
				## ESPIOANGE MISSION WAS UNSUCCESSFUL ON YOUR COUNTRY
			}
			country_event = espionage_missions.3 ## UNSUCCESSFUL MISSION EVENT
		}else = {### CRITICAL FAILURE EFFECTS
			chance_of_death = yes ## CALCULATES WEATHER DEATH CHANCE WILL HAPPEN OR NOT, CRITICAL FALIURE EVENT IS HELD IN HERE
		}
	}
}


chance_of_death = {
	set_temp_variable = {agent_surviability_bonuses = modifier@espionage_agent_survivability}
	set_temp_variable = {death_chance = 10}
	subtract_from_temp_variable = {death_chance = agent_surviability_bonuses}
	subtract_from_temp_variable = {death_chance = agent_expertise}
	clamp_temp_variable = {
		var = death_chance
		min = 5
	}
	randomize_temp_variable = {  ## death generator
		var = chance_of_death
		distribution = uniform
		min = 1
		max = 100
	}
	if = {
		limit = {
			check_variable = {
				var = chance_of_death
				value = death_chance
				compare = less_than_or_equals
			}
		}
		country_event = espionage_missions.9 ## CRITICAL FAILURE EVENT AGENT DEATH
		var:targeted_country = {
			## CRITICAL FAILURE EFFECTS ON TARGET COUNTRY
			country_event = espionage_missions.10 ## ESPIOANGE CRITICAL SUCCESS WAS UNSUCCESSFUL ON YOUR COUNTRY
		}
		meta_effect = { # REMOVING AGENT VARIABLES
			text = {
				clear_variable = agent_name_slot_[WHAT_SLOT_IT_IS]
				clear_variable = agent_charisma_slot_[WHAT_SLOT_IT_IS]
				clear_variable = agent_intelligence_slot_[WHAT_SLOT_IT_IS]
				clear_variable = agent_martial_slot_[WHAT_SLOT_IT_IS]
				clear_variable = personality_trait_slot_[WHAT_SLOT_IT_IS]
				clear_variable = class_trait_slot_[WHAT_SLOT_IT_IS]
				clear_variable = race_trait_slot_[WHAT_SLOT_IT_IS]
				clear_variable = expertise_slot_[WHAT_SLOT_IT_IS]
				clear_variable = expertise_progress_slot_[WHAT_SLOT_IT_IS]
			}
			WHAT_SLOT_IT_IS = "[?agent_slot_number]"
		}
	}else = {
		var:targeted_country = {
			## CRITICAL FAILURE EFFECTS ON TARGET COUNTRY
			country_event = espionage_missions.8 ## ESPIOANGE CRITICAL SUCCESS WAS UNSUCCESSFUL ON YOUR COUNTRY
		}
		country_event = espionage_missions.4 ## CRITICAL FAILURE EVENT
	}
}





assassinate_mission_end_effect = { ## assassinate mission end effect
	set_temp_variable = { net_size = agent_martial } ## find characters martial and sets net_size to then work out success chance
	multiply_temp_variable = { net_size = 6 } ## 6 on how easy it is
	multiply_temp_variable = { net_size = Total_counterespionage_vs_espionage_percentage} ## multiply the bonuses to get total net size
	if = {
		limit = {
			check_variable = {
				var = chance_of_success
				value = net_size
				compare = greater_than_or_equals
			}
		}
		if = {
			limit = {
				check_variable = {chance_of_success > 10}
			}
			var:targeted_country = {
				every_unit_leader = {
					limit = {
						has_character_flag = targeted_by_mission
						has_character_flag = targeted_by_@ROOT_1_murder
					}
					add_timed_unit_leader_trait = {
						trait = wounded
						days = 180
					}
					unit_leader_event = {id = espionage.1}
				}
			}
			country_event = espionage_missions.5
		}else = {														 ### CRITICAL SUCCESSS
			var:targeted_country = { ### ASSASSIN KILLS TARGET
				every_unit_leader = {
					limit = {
						has_character_flag = targeted_by_mission
						has_character_flag = targeted_by_@ROOT_1_murder
					}
					retire = yes
					unit_leader_event = {id = espionage.2}
				}
			}
			country_event = espionage_missions.14
		}
	}else = {## FALIURE
		country_event = espionage_missions.6
		var:targeted_country = {
			country_event = espionage_missions.9
			every_unit_leader = {
				limit = {
					has_character_flag = targeted_by_mission
					has_character_flag = targeted_by_@ROOT_1_murder
				}
				clr_character_flag = targeted_by_training
				clr_character_flag = targeted_by_@ROOT_1_murder
			}
		}
	}
}
ransom_mission_end_effect = {
	set_temp_variable = { net_size = agent_martial }
	add_to_temp_variable = { net_size = agent_intelligence }
	divide_temp_variable = { net_size = 2 }
	multiply_temp_variable = { net_size = 5 }
	multiply_temp_variable = { net_size = Total_counterespionage_vs_espionage_percentage} ## multiply the bonuses to get total net size
	if = {
		limit = {
			check_variable = {
				var = chance_of_success
				value = net_size
				compare = greater_than_or_equals
			}
		}
		var:targeted_country = {
			country_event = {
				id = espionage.2
				days = 1
			}
		}
	}else = {
		country_event = espionage_missions.3
	}
}
army_training_mission_end_effect = { ## Army Training
	set_temp_variable = { net_size = agent_martial }
	add_to_temp_variable = { net_size = agent_intelligence }
	divide_temp_variable = { net_size = 2 }
	multiply_temp_variable = { net_size = 5 }
	if = {
		limit = {
			check_variable = {
				var = chance_of_success
				value = net_size
				compare = greater_than_or_equals
			}
		}
		every_unit_leader = {
			limit = {
				has_character_flag = targeted_by_mission
				has_character_flag = targeted_by_training
			}
			add_random_trait = {
				organizer
				cavalry_leader
				infantry_leader
				skilled_staffer
				trickster
				infantry_officer
				armor_officer
			}
		}
		country_event = espionage_missions.1
	}else = {## FALIURE
		country_event = espionage_missions.3
		every_unit_leader = {
			limit = {
				has_character_flag = targeted_by_mission
				has_character_flag = targeted_by_training
			}
			clr_character_flag = targeted_by_training
			clr_character_flag = targeted_by_mission
		}
	}
}
intimidate_senator_mission_end_effect = { ## Blackmail Senator
	set_temp_variable = { net_size = agent_martial }
	add_to_temp_variable = { net_size = agent_charisma }
	divide_temp_variable = { net_size = 2 }
	multiply_temp_variable = { net_size = 10 }
	multiply_temp_variable = { net_size = Total_counterespionage_vs_espionage_percentage} ## multiply the bonuses to get total net size
	
}
cyber_attack_mission_end_effect = {
	set_temp_variable = { net_size = agent_intelligence }
	multiply_temp_variable = { net_size = 5 }
	multiply_temp_variable = { net_size = Total_counterespionage_vs_espionage_percentage} ## multiply the bonuses to get total net size
	if = {
		limit = {
			check_variable = {
				var = chance_of_success
				value = net_size
				compare = greater_than_or_equals
			}
		}
		var:targeted_country = {
			add_timed_idea = {
				idea = cyber_attack_espionage
				days = 100
			}
			country_event = espionage_missions.5
		}
		country_event = espionage_missions.1
	}else = {## FALIURE
		country_event = espionage_missions.3
		var:targeted_country = {
			country_event = espionage_missions.7
		}
	}
}
steal_blueprint_mission_end_effect = {
	set_temp_variable = { net_size = agent_intelligence }
	add_to_temp_variable = { net_size = agent_charisma }
	divide_temp_variable = { net_size = 2 }
	multiply_temp_variable = { net_size = 8 }
	multiply_temp_variable = { net_size = Total_counterespionage_vs_espionage_percentage} ## multiply the bonuses to get total net size
	if = {
		limit = {
			check_variable = {
				var = chance_of_success
				value = net_size
				compare = greater_than_or_equals
			}
		}
		var:targeted_country = {
			steal_random_tech_bonus = {
				folder = electronics_folder
				folder = industry_folder
				bonus = 3.0
				dynamic = no
				instant = yes
				name = operation_steal_tech_civilian
				target = FROM
				uses = 1
			}
			country_event = espionage_missions.5
		}
		country_event = espionage_missions.1
	}else = {## FALIURE
		country_event = espionage_missions.3
		var:targeted_country = {
			country_event = espionage_missions.7
		}
	}
}
sprout_disease_mission_end_effect = {
	set_temp_variable = { net_size = agent_intelligence }
	add_to_temp_variable = { net_size = agent_charisma }
	divide_temp_variable = { net_size = 2 }
	multiply_temp_variable = { net_size = 5 }
	multiply_temp_variable = { net_size = Total_counterespionage_vs_espionage_percentage} ## multiply the bonuses to get total net size
	if = {
		limit = {
			check_variable = {
				var = chance_of_success
				value = net_size
				compare = greater_than_or_equals
			}
		}
		var:targeted_country = {
			capital_scope = {
				add_manpower = -50000
			}
			country_event = espionage_missions.5
		}
		country_event = espionage_missions.1
	}else = {## FALIURE
		country_event = espionage_missions.3
		var:targeted_country = {
			country_event = espionage_missions.7
		}
	}
}
logistics_sabotage_mission_end_effect = {
	set_temp_variable = { net_size = agent_intelligence }
	add_to_temp_variable = { net_size = agent_martial }
	divide_temp_variable = { net_size = 2 }
	multiply_temp_variable = { net_size = 8 }
	multiply_temp_variable = { net_size = Total_counterespionage_vs_espionage_percentage} ## multiply the bonuses to get total net size
	if = {
		limit = {
			check_variable = {
				var = chance_of_success
				value = net_size
				compare = greater_than_or_equals
			}
		}
		var:targeted_country = {
			add_timed_idea = {
				idea = logistics_sabotage_espionage
				days = 40
			}
			country_event = espionage_missions.5
		}
		country_event = espionage_missions.1
	}else = {## FALIURE
		country_event = espionage_missions.3
		var:targeted_country = {
			country_event = espionage_missions.7
		}
	}
}
industrial_sabotage_mission_end_effect = {
	set_temp_variable = { net_size = agent_intelligence }
	add_to_temp_variable = { net_size = agent_martial }
	divide_temp_variable = { net_size = 2 }
	multiply_temp_variable = { net_size = 12 }
	multiply_temp_variable = { net_size = Total_counterespionage_vs_espionage_percentage} ## multiply the bonuses to get total net size
	if = {
		limit = {
			check_variable = {
				var = chance_of_success
				value = net_size
				compare = greater_than_or_equals
			}
		}
		var:targeted_country = {
			while_loop_effect = {
				break = temp_break
				limit = {
					NOT = {
						has_variable = targeted_country
					}
				}
				random_core_state = {
					if = {
						limit = {
							arms_factory > 1
						}
						remove_building = {
							type = arms_factory
							level = 1
						}
						set_temp_variable = {temp_break = 1}
					}else_if = {
						limit = {
							industrial_complex > 1
						}
						remove_building = {
							type = industrial_complex
							level = 1
						}
						set_temp_variable = {temp_break = 1}
					}
				}
			}
			country_event = espionage_missions.3
		}
		country_event = espionage_missions.1
	}else = {## FALIURE
		country_event = espionage_missions.3
		var:targeted_country = {
			country_event = espionage_missions.7
		}
	}
}
infilitrate_military_mission_end_effect = {
	set_temp_variable = { net_size = agent_martial }
	add_to_temp_variable = { net_size = agent_charisma }
	divide_temp_variable = { net_size = 2 }
	multiply_temp_variable = { net_size = 6 }
	multiply_temp_variable = { net_size = Total_counterespionage_vs_espionage_percentage} ## multiply the bonuses to get total net size
	if = {
		limit = {
			check_variable = {
				var = chance_of_success
				value = net_size
				compare = greater_than_or_equals
			}
		}
		add_intel = {
			target = var:targeted_country
			army_intel = 30
			navy_intel = 30
			airforce_intel = 30
		}
		var:targeted_country = {
			country_event = espionage_missions.5
		}
		country_event = espionage_missions.1
	}else = {## FALIURE
		country_event = espionage_missions.3
		var:targeted_country = {
			country_event = espionage_missions.7
		}
	}
}
undermine_guild_mission_end_effect = {
	set_temp_variable = { net_size = agent_intelligence }
	add_to_temp_variable = { net_size = agent_charisma }
	divide_temp_variable = { net_size = 2 }
	multiply_temp_variable = { net_size = 8 }
	multiply_temp_variable = { net_size = Total_counterespionage_vs_espionage_percentage} ## multiply the bonuses to get total net size
	if = {
		limit = {
			check_variable = {
				var = chance_of_success
				value = net_size
				compare = greater_than_or_equals
			}
		}
		var:targeted_country = {
			country_event = espionage_missions.5
		}
		country_event = espionage_missions.1
	}else = {## FALIURE
		country_event = espionage_missions.3
		var:targeted_country = {
			country_event = espionage_missions.7
		}
	}
}
destroy_capital_ship_mission_end_effect = {
	set_temp_variable = { net_size = agent_martial }
	divide_temp_variable = { net_size = 2 }
	multiply_temp_variable = { net_size = 5 }
	multiply_temp_variable = { net_size = Total_counterespionage_vs_espionage_percentage} ## multiply the bonuses to get total net size
	if = {
		limit = {
			check_variable = {
				var = chance_of_success
				value = net_size
				compare = greater_than_or_equals
			}
		}
		var:targeted_country = {
			if = {
				limit = {
					check_variable = {
						var = num_ships_with_type@carrier  ## CHANGE_ME, need to ask diosysnus about ship types
						value = 1
						compare = greater_than
					}
				}
				destroy_ships = {
					type = carrier
					count = 1
				}
			}else_if = {
				limit = {
					check_variable = {
						var = num_ships_with_type@battleship ## CHANGE_ME, need to ask diosysnus about ship types
						value = 1
						compare = greater_than
					}
				}
				destroy_ships = {
					type = battleship
					count = 1
				}
			}
			country_event = espionage_missions.5
		}
		country_event = espionage_missions.1
	}else = {## FALIURE
		country_event = espionage_missions.3
		var:targeted_country = {
			country_event = espionage_missions.7
		}
	}
}
steal_equipment_mission_end_effect = {
	set_temp_variable = { net_size = agent_martial }
	add_to_temp_variable = { net_size = agent_intelligence }
	divide_temp_variable = { net_size = 2 }
	multiply_temp_variable = { net_size = 10 }
	multiply_temp_variable = { net_size = Total_counterespionage_vs_espionage_percentage} ## multiply the bonuses to get total net size
	if = {
		limit = {
			check_variable = {
				var = chance_of_success
				value = net_size
				compare = greater_than_or_equals
			}
		}
		var:targeted_country = {
			send_equipment_fraction = {
				value = 0.02
				target = PREV
			}
			country_event = espionage_missions.5
		}
		country_event = espionage_missions.1
	}else = {## FALIURE
		country_event = espionage_missions.3
		var:targeted_country = {
			country_event = espionage_missions.7
		}
	}
}
smuggle_slaves_mission_end_effect = {
	set_temp_variable = { net_size = agent_martial }
	add_to_temp_variable = { net_size = agent_intelligence }
	divide_temp_variable = { net_size = 2 }
	multiply_temp_variable = { net_size = 8 }
	multiply_temp_variable = { net_size = Total_counterespionage_vs_espionage_percentage} ## multiply the bonuses to get total net size
	if = {
		limit = {
			check_variable = {
				var = chance_of_success
				value = net_size
				compare = greater_than_or_equals
			}
		}
		var:targeted_country = {
			find_highest_in_array = { 
				array = slaves
				value = slave_value_count_temp
				index = slave_index_espionage_temp
			}
			divide_variable = {slave_value_count_temp = 3} ## Thought this might be cleaner
			multiply_variable = {slave_value_count_temp = 2}
			round_variable = slave_value_count_temp
			set_variable = { slaves^slave_index_espionage_temp = slave_value_count_temp }
			country_event = espionage_missions.5
		}
		country_event = espionage_missions.1
		set_variable = { slaves^targeted_country.slave_index_espionage_temp = var:targeted_country.slave_value_count_temp} ## this is stupid and should be treated as such
	}else = {## FALIURE
		country_event = espionage_missions.3
		var:targeted_country = {
			country_event = espionage_missions.7
		}
	}
}
free_slaves_mission_end_effect = {
	set_temp_variable = { net_size = agent_martial }
	add_to_temp_variable = { net_size = agent_intelligence }
	divide_temp_variable = { net_size = 2 }
	multiply_temp_variable = { net_size = 10 }
	multiply_temp_variable = { net_size = Total_counterespionage_vs_espionage_percentage} ## multiply the bonuses to get total net size
	if = {
		limit = {
			check_variable = {
				var = chance_of_success
				value = net_size
				compare = greater_than_or_equals
			}
		}
		var:targeted_country = {
			find_highest_in_array = { 
				array = slaves
				value = slave_value_count_temp
				index = slave_index_espionage_temp
			}
			divide_variable = {slave_value_count_temp = 3} ## Thought this might be cleaner
			multiply_variable = {slave_value_count_temp = 2}
			round_variable = slave_value_count_temp
			set_variable = { slaves^slave_index_espionage_temp = slave_value_count_temp }
			country_event = espionage_missions.5
		}
		country_event = espionage_missions.1
	}else = {## FALIURE
		country_event = espionage_missions.3
		var:targeted_country = {
			country_event = espionage_missions.7
		}
	}
}
provoke_slave_revolt_mission_end_effect = {
	set_temp_variable = { net_size = agent_martial }
	add_to_temp_variable = { net_size = agent_charisma }
	divide_temp_variable = { net_size = 2 }
	multiply_temp_variable = { net_size = 4 }
	multiply_temp_variable = { net_size = Total_counterespionage_vs_espionage_percentage} ## multiply the bonuses to get total net size
	if = {
		limit = {
			check_variable = {
				var = chance_of_success
				value = net_size
				compare = greater_than_or_equals
			}
		}
		var:targeted_country = {
			set_temp_variable = { slave_total_count_temp = 0 }
			for_each_loop = {
				array = slaves
				value = slave_index_count

				add_to_temp_variable = {slave_total_count_temp = slave_index_count}
			}
			divide_variable = {slave_total_count_temp = 800000}
			random_core_state = {
					set_variable = { core_temp_state = THIS.id}
			}
			start_civil_war = {
				ruling_party = neutrality
				ideology = ROOT
				size = slave_total_count_temp
				capital = var:core_temp_state
				navy_ratio = 0
				states_filter = {
					check_variable = {var:core_temp_state = THIS.id}
				}
				keep_unit_leaders_trigger = {
					always = yes
				}
				keep_political_leader = yes
				keep_political_party_members = yes
			}
			country_event = espionage_missions.5
		}
		country_event = espionage_missions.1
	}else = {## FALIURE
		country_event = espionage_missions.3
		var:targeted_country = {
			country_event = espionage_missions.7
		}
	}
}
arm_dissidents_mission_end_effect = {
	set_temp_variable = { net_size = agent_martial }
	add_to_temp_variable = { net_size = agent_charisma }
	divide_temp_variable = { net_size = 2 }
	multiply_temp_variable = { net_size = 10 }
	multiply_temp_variable = { net_size = Total_counterespionage_vs_espionage_percentage} ## multiply the bonuses to get total net size
	if = {
		limit = {
			check_variable = {
				var = chance_of_success
				value = net_size
				compare = greater_than_or_equals
			}
		}
		var:targeted_country = {
			every_controlled_state = {
				limit = {
					has_active_resistance = yes
				}
				add_resistance = 20 
			}
			country_event = espionage_missions.5
		}
		country_event = espionage_missions.1
	}else = {## FALIURE
		country_event = espionage_missions.3
		var:targeted_country = {
			country_event = espionage_missions.7
		}
	}
}
plant_sleeper_agent_mission_end_effect = {
	set_temp_variable = { net_size = agent_intelligence }
	add_to_temp_variable = { net_size = agent_charisma }
	divide_temp_variable = { net_size = 2 }
	multiply_temp_variable = { net_size = 12 }
	multiply_temp_variable = { net_size = Total_counterespionage_vs_espionage_percentage} ## multiply the bonuses to get total net size
	if = {
		limit = {
			check_variable = {
				var = chance_of_success
				value = net_size
				compare = greater_than_or_equals
			}
		}
		var:targeted_country = {
			country_event = espionage_missions.5
		}
		country_event = espionage_missions.1
		set_variable = {higher_chance_espionage_target = var:targeted_country.id }
	}else = {## FALIURE
		country_event = espionage_missions.3
		var:targeted_country = {
			country_event = espionage_missions.7
		}
	}
}
reroute_supply_mission_end_effect = {
	set_temp_variable = { net_size = agent_intelligence }
	add_to_temp_variable = { net_size = agent_charisma }
	divide_temp_variable = { net_size = 2 }
	multiply_temp_variable = { net_size = 8 }
	multiply_temp_variable = { net_size = Total_counterespionage_vs_espionage_percentage} ## multiply the bonuses to get total net size
	if = {
		limit = {
			check_variable = {
				var = chance_of_success
				value = net_size
				compare = greater_than_or_equals
			}
		}
		var:targeted_country = {
			subtract_from_variable = { currency_amount^primary_currency = 1000 }
			country_event = espionage_missions.5
		}
		country_event = espionage_missions.1
	}else = {## FALIURE
		country_event = espionage_missions.3
		var:targeted_country = {
			country_event = espionage_missions.7
		}
	}
}
market_crash_mission_end_effect = {
	set_temp_variable = { net_size = agent_intelligence }
	add_to_temp_variable = { net_size = agent_charisma }
	divide_temp_variable = { net_size = 2 }
	multiply_temp_variable = { net_size = 8 }
	multiply_temp_variable = { net_size = Total_counterespionage_vs_espionage_percentage} ## multiply the bonuses to get total net size
	if = {
		limit = {
			check_variable = {
				var = chance_of_success
				value = net_size
				compare = greater_than_or_equals
			}
		}
		country_event = espionage_missions.1
		var:targeted_country = {
			give_resource_rights = { receiver = ROOT state = capital }
			country_event = espionage_missions.5
			country_event = {
				id = espionage.4
				days = 80
			}
		}
	}else = {## FALIURE
		country_event = espionage_missions.7
	}
}

create_temporary_agents = { ## CREATE TEMPORARY AGENTS FOR RECRUITMENT
	set_temp_variable = {agent_name = 0} ## HOLDS IDENTIFIER TOKEN
	set_temp_variable = {agent_charisma = 0} 
	set_temp_variable = {agent_intelligence = 0}
	set_temp_variable = {agent_martial = 0}
	set_temp_variable = {personality_trait = 0}
	set_temp_variable = {class_trait = 0}
	set_temp_variable = {race_trait = 0}
	random_list = {
		100 = {
			modifier = {
				add = spy_guild_loyalty
			}
			modifier = {
				factor = 0
				check_variable = {global.Espionage_intelligence_array^num = 0}
			}
			set_variable_to_random = {
				var = random_num
				min = 0
				max = global.Espionage_intelligence_array^num
				integer = yes
			}
			set_temp_variable = {agent_name = global.Espionage_intelligence_array^random_num}
            remove_from_array = {
                array = global.Espionage_intelligence_array
                index = random_num
            }
			set_country_flag = agent_1_Espionage_intelligence_array
		}
		100 = {
			modifier = {
				add = technicians_loyalty
			}
			modifier = {
				factor = 0
				check_variable = {global.Espionage_technicians_array^num = 0}
			}
			set_variable_to_random = {
				var = random_num
				min = 0
				max = global.Espionage_technicians_array^num
				integer = yes
			}
			set_temp_variable = {agent_name = global.Espionage_technicians_array^random_num}
            remove_from_array = {
                array = global.Espionage_technicians_array
                index = random_num
            }
			set_country_flag = agent_1_Espionage_technicians_array
		}
		100 = {
			modifier = {
				add = counter_intelligence_guild_loyalty
			}
			modifier = {
				factor = 0
				check_variable = {global.Espionage_counterintelligence_array^num = 0}
			}
			set_variable_to_random = {
				var = random_num
				min = 0
				max = global.Espionage_counterintelligence_array^num
				integer = yes
			}
			set_temp_variable = {agent_name = global.Espionage_counterintelligence_array^random_num}
            remove_from_array = {
                array = global.Espionage_counterintelligence_array
                index = random_num
            }
			set_country_flag = agent_1_Espionage_counterintelligence_array
		}
		100 = {
			modifier = {
				add = smugglers_loyalty
			}
			modifier = {
				factor = 0
				check_variable = {global.Espionage_smugglers_array^num = 0}
			}
			set_variable_to_random = {
				var = random_num
				min = 0
				max = global.Espionage_smugglers_array^num
				integer = yes
			}
			set_temp_variable = {agent_name = global.Espionage_smugglers_array^random_num}
            remove_from_array = {
                array = global.Espionage_smugglers_array
                index = random_num
            }
			set_country_flag = agent_1_Espionage_smugglers_array
		}
		100 = {
			modifier = {
				add = bounty_hunter_loyalty
			}
			modifier = {
				factor = 0
				check_variable = {global.Espionage_bounty_hunter_array^num = 0}
			}
			set_variable_to_random = {
				var = random_num
				min = 0
				max = global.Espionage_bounty_hunter_array^num
				integer = yes
			}
			set_temp_variable = {agent_name = global.Espionage_bounty_hunter_array^random_num}
            remove_from_array = {
                array = global.Espionage_bounty_hunter_array
                index = random_num
            }
			set_country_flag = agent_1_Espionage_bounty_hunter_array
		}
	}
	meta_effect = {
		text = {
			agent_recruitment_[AGENT_NAME] = yes
		}
		AGENT_NAME = "[?agent_name.GetTokenKey]"
	}
	set_variable = {agent_name_temporary_agent_1 = agent_name}
	set_variable = {agent_charisma_temporary_agent_1 = agent_charisma}
	set_variable = {agent_intelligence_temporary_agent_1 = agent_intelligence}
	set_variable = {agent_martial_temporary_agent_1 = agent_martial}
	set_variable = {personality_trait_temporary_agent_1 = personality_trait}
	set_variable = {class_trait_temporary_agent_1 = class_trait}
	set_variable = {race_trait_temporary_agent_1 = race_trait}
	set_temp_variable = {agent_name = 0} ## HOLDS IDENTIFIER TOKEN
	set_temp_variable = {agent_charisma = 0} 
	set_temp_variable = {agent_intelligence = 0}
	set_temp_variable = {agent_martial = 0}
	set_temp_variable = {personality_trait = 0}
	set_temp_variable = {class_trait = 0}
	set_temp_variable = {race_trait = 0}
	random_list = {
		100 = {
			modifier = {
				add = spy_guild_loyalty
			}
			modifier = {
				factor = 0
				check_variable = {global.Espionage_intelligence_array^num = 0}
			}
			set_variable_to_random = {
				var = random_num
				min = 0
				max = global.Espionage_intelligence_array^num
				integer = yes
			}
			set_temp_variable = {agent_name = global.Espionage_intelligence_array^random_num}
			remove_from_array = {
				array = global.Espionage_intelligence_array
				index = random_num
			}
			set_country_flag = agent_2_Espionage_intelligence_array
		}
		100 = {
			modifier = {
				add = technicians_loyalty
			}
			modifier = {
				factor = 0
				check_variable = {global.Espionage_technicians_array^num = 0}
			}
			set_variable_to_random = {
				var = random_num
				min = 0
				max = global.Espionage_technicians_array^num
				integer = yes
			}
			set_temp_variable = {agent_name = global.Espionage_technicians_array^random_num}
			remove_from_array = {
				array = global.Espionage_technicians_array
				index = random_num
			}
			set_country_flag = agent_2_Espionage_technicians_array
		}
		100 = {
			modifier = {
				add = counter_intelligence_guild_loyalty
			}
			modifier = {
				factor = 0
				check_variable = {global.Espionage_counterintelligence_array^num = 0}
			}
			set_variable_to_random = {
				var = random_num
				min = 0
				max = global.Espionage_counterintelligence_array^num
				integer = yes
			}
			set_temp_variable = {agent_name = global.Espionage_counterintelligence_array^random_num}
			remove_from_array = {
				array = global.Espionage_counterintelligence_array
				index = random_num
			}
			set_country_flag = agent_2_Espionage_counterintelligence_array
		}
		100 = {
			modifier = {
				add = smugglers_loyalty
			}
			modifier = {
				factor = 0
				check_variable = {global.Espionage_smugglers_array^num = 0}
			}
			set_variable_to_random = {
				var = random_num
				min = 0
				max = global.Espionage_smugglers_array^num
				integer = yes
			}
			set_temp_variable = {agent_name = global.Espionage_smugglers_array^random_num}
			remove_from_array = {
				array = global.Espionage_smugglers_array
				index = random_num
			}
			set_country_flag = agent_2_Espionage_smugglers_array
		}
		100 = {
			modifier = {
				add = bounty_hunter_loyalty
			}
			modifier = {
				factor = 0
				check_variable = {global.Espionage_bounty_hunter_array^num = 0}
			}
			set_variable_to_random = {
				var = random_num
				min = 0
				max = global.Espionage_bounty_hunter_array^num
				integer = yes
			}
			set_temp_variable = {agent_name = global.Espionage_bounty_hunter_array^random_num}
			remove_from_array = {
				array = global.Espionage_bounty_hunter_array
				index = random_num
			}
			set_country_flag = agent_2_Espionage_bounty_hunter_array
		}
	}
	meta_effect = {
		text = {
			agent_recruitment_[AGENT_NAME] = yes
		}
		AGENT_NAME = "[?agent_name.GetTokenKey]"
	}
	set_variable = {agent_name_temporary_agent_2 = agent_name}
	set_variable = {agent_charisma_temporary_agent_2 = agent_charisma}
	set_variable = {agent_intelligence_temporary_agent_2 = agent_intelligence}
	set_variable = {agent_martial_temporary_agent_2 = agent_martial}
	set_variable = {personality_trait_temporary_agent_2 = personality_trait}
	set_variable = {class_trait_temporary_agent_2 = class_trait}
	set_variable = {race_trait_temporary_agent_2 = race_trait}
	set_temp_variable = {agent_name = 0} ## HOLDS IDENTIFIER TOKEN
	set_temp_variable = {agent_charisma = 0} 
	set_temp_variable = {agent_intelligence = 0}
	set_temp_variable = {agent_martial = 0}
	set_temp_variable = {personality_trait = 0}
	set_temp_variable = {class_trait = 0}
	set_temp_variable = {race_trait = 0}
	random_list = {
		100 = {
			modifier = {
				add = spy_guild_loyalty
			}
			modifier = {
				factor = 0
				check_variable = {global.Espionage_intelligence_array^num = 0}
			}
			set_variable_to_random = {
				var = random_num
				min = 0
				max = global.Espionage_intelligence_array^num
				integer = yes
			}
			set_temp_variable = {agent_name = global.Espionage_intelligence_array^random_num}
			remove_from_array = {
				array = global.Espionage_intelligence_array
				index = random_num
			}
			set_country_flag = agent_3_Espionage_intelligence_array
		}
		100 = {
			modifier = {
				add = technicians_loyalty
			}
			modifier = {
				factor = 0
				check_variable = {global.Espionage_technicians_array^num = 0}
			}
			set_variable_to_random = {
				var = random_num
				min = 0
				max = global.Espionage_technicians_array^num
				integer = yes
			}
			set_temp_variable = {agent_name = global.Espionage_technicians_array^random_num}
			remove_from_array = {
				array = global.Espionage_technicians_array
				index = random_num
			}
			set_country_flag = agent_3_Espionage_technicians_array
		}
		100 = {
			modifier = {
				add = counter_intelligence_guild_loyalty
			}
			modifier = {
				factor = 0
				check_variable = {global.Espionage_counterintelligence_array^num = 0}
			}
			set_variable_to_random = {
				var = random_num
				min = 0
				max = global.Espionage_counterintelligence_array^num
				integer = yes
			}
			set_temp_variable = {agent_name = global.Espionage_counterintelligence_array^random_num}
			remove_from_array = {
				array = global.Espionage_counterintelligence_array
				index = random_num
			}
			set_country_flag = agent_3_Espionage_counterintelligence_array
		}
		100 = {
			modifier = {
				add = smugglers_loyalty
			}
			modifier = {
				factor = 0
				check_variable = {global.Espionage_smugglers_array^num = 0}
			}
			set_variable_to_random = {
				var = random_num
				min = 0
				max = global.Espionage_smugglers_array^num
				integer = yes
			}
			set_temp_variable = {agent_name = global.Espionage_smugglers_array^random_num}
			remove_from_array = {
				array = global.Espionage_smugglers_array
				index = random_num
			}
			set_country_flag = agent_3_Espionage_smugglers_array
		}
		100 = {
			modifier = {
				add = bounty_hunter_loyalty
			}
			modifier = {
				factor = 0
				check_variable = {global.Espionage_bounty_hunter_array^num = 0}
			}
			set_variable_to_random = {
				var = random_num
				min = 0
				max = global.Espionage_bounty_hunter_array^num
				integer = yes
			}
			set_temp_variable = {agent_name = global.Espionage_bounty_hunter_array^random_num}
			remove_from_array = {
				array = global.Espionage_bounty_hunter_array
				index = random_num
			}
			set_country_flag = agent_3_Espionage_bounty_hunter_array
		}
	}
	meta_effect = {
		text = {
			agent_recruitment_[AGENT_NAME] = yes
		}
		AGENT_NAME = "[?agent_name.GetTokenKey]"
	}
	set_variable = {agent_name_temporary_agent_3 = agent_name}
	set_variable = {agent_charisma_temporary_agent_3 = agent_charisma}
	set_variable = {agent_intelligence_temporary_agent_3 = agent_intelligence}
	set_variable = {agent_martial_temporary_agent_3 = agent_martial}
	set_variable = {personality_trait_temporary_agent_3 = personality_trait}
	set_variable = {class_trait_temporary_agent_3 = class_trait}
	set_variable = {race_trait_temporary_agent_3 = race_trait}
}

agent_recruitment_kairan_ember = { ## ALL FEEDS UP TO create_temporary_agents EFFECT
	set_temp_variable = {agent_name = token:kairan_ember}
	set_temp_variable = {agent_charisma = 10} 
	set_temp_variable = {agent_intelligence = 10}
	set_temp_variable = {agent_martial = 10}
	set_temp_variable = {personality_trait = token:cautious} ## LOOK AT ESPIONAGE_TOKENS FOR TRAITS
	set_temp_variable = {class_trait = token:bounty_hunter} ## LOOK AT ESPIONAGE_TOKENS FOR TRAITS
	set_temp_variable = {race_trait = token:bothan} ## LOOK AT ESPIONAGE_TOKENS FOR TRAITS, RACE TRAIT IS NOT NEEDED, YOU CAN IGNORE THIS. PORTRAIT WILL NEED TO BE THE ACTUAL RACE (no mandolorians that look like ronald mcdonald)
}

agent_recruitment_polo_lye = { ## ALL FEEDS UP TO create_temporary_agents EFFECT
	set_temp_variable = {agent_name = token:polo_lye}
	set_temp_variable = {agent_charisma = 10} 
	set_temp_variable = {agent_intelligence = 10}
	set_temp_variable = {agent_martial = 10}
	set_temp_variable = {personality_trait = token:cheapskate} ## LOOK AT ESPIONAGE_TOKENS FOR TRAITS
	set_temp_variable = {class_trait = token:smuggler} ## LOOK AT ESPIONAGE_TOKENS FOR TRAITS
	set_temp_variable = {race_trait = token:zeltros} ## LOOK AT ESPIONAGE_TOKENS FOR TRAITS, RACE TRAIT IS NOT NEEDED, YOU CAN IGNORE THIS. PORTRAIT WILL NEED TO BE THE ACTUAL RACE (no mandolorians that look like ronald mcdonald)
}

agent_recruitment_orion_voss = { ## ALL FEEDS UP TO create_temporary_agents EFFECT
	set_temp_variable = {agent_name = token:orion_voss}
	set_temp_variable = {agent_charisma = 10} 
	set_temp_variable = {agent_intelligence = 10}
	set_temp_variable = {agent_martial = 10}
	set_temp_variable = {personality_trait = token:arrogant} ## LOOK AT ESPIONAGE_TOKENS FOR TRAITS
	set_temp_variable = {class_trait = token:information_broker} ## LOOK AT ESPIONAGE_TOKENS FOR TRAITS
	set_temp_variable = {race_trait = token:falleen} ## LOOK AT ESPIONAGE_TOKENS FOR TRAITS, RACE TRAIT IS NOT NEEDED, YOU CAN IGNORE THIS. PORTRAIT WILL NEED TO BE THE ACTUAL RACE (no mandolorians that look like ronald mcdonald)
}



test_espionage_effect = {
}
clear_temp_variable_in_agents = {
	clear_variable = agent_name_temporary_agent_3
	clear_variable = agent_charisma_temporary_agent_3
	clear_variable = agent_intelligence_temporary_agent_3
	clear_variable = agent_martial_temporary_agent_3
	clear_variable = class_trait_temporary_agent_3
	clear_variable = personality_trait_temporary_agent_3
	clear_variable = race_trait_temporary_agent_3

	clear_variable = agent_name_temporary_agent_2
	clear_variable = agent_charisma_temporary_agent_2
	clear_variable = agent_intelligence_temporary_agent_2
	clear_variable = agent_martial_temporary_agent_2
	clear_variable = class_trait_temporary_agent_2
	clear_variable = personality_trait_temporary_agent_2
	clear_variable = race_trait_temporary_agent_2

	clear_variable = agent_name_temporary_agent_1
	clear_variable = agent_charisma_temporary_agent_1
	clear_variable = agent_intelligence_temporary_agent_1
	clear_variable = agent_martial_temporary_agent_1
	clear_variable = class_trait_temporary_agent_1
	clear_variable = personality_trait_temporary_agent_1
	clear_variable = race_trait_temporary_agent_1

	clr_country_flag = agent_1_Espionage_intelligence_array
	clr_country_flag = agent_1_Espionage_technicians_array
	clr_country_flag = agent_1_Espionage_counterintelligence_array
	clr_country_flag = agent_1_Espionage_smugglers_array
	clr_country_flag = agent_1_Espionage_bounty_hunter_array

	clr_country_flag = agent_2_Espionage_intelligence_array
	clr_country_flag = agent_2_Espionage_technicians_array
	clr_country_flag = agent_2_Espionage_counterintelligence_array
	clr_country_flag = agent_2_Espionage_smugglers_array
	clr_country_flag = agent_2_Espionage_bounty_hunter_array

	clr_country_flag = agent_3_Espionage_intelligence_array
	clr_country_flag = agent_3_Espionage_technicians_array
	clr_country_flag = agent_3_Espionage_counterintelligence_array
	clr_country_flag = agent_3_Espionage_smugglers_array
	clr_country_flag = agent_3_Espionage_bounty_hunter_array
}
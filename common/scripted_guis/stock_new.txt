scripted_gui = {
	stock_market_new = {
		context_type = player_context
		window_name = "stock_market_new"
		visible = {
			has_government = corporation
			always = yes
		}

		effects = {
			buy_1_button_click = {
				set_country_flag = buying_1_share
				clr_country_flag = buying_10_share
				clr_country_flag = buying_50_share
			}
			buy_2_button_click = {
				set_country_flag = buying_10_share
				clr_country_flag = buying_1_share
				clr_country_flag = buying_50_share
			}
			buy_3_button_click = {
				set_country_flag = buying_50_share
				clr_country_flag = buying_1_share
				clr_country_flag = buying_10_share
			}
			buy_button_click = {
				if = {
					limit = {
						has_country_flag = buying_1_share
					}
					ROOT = {
						add_to_variable = { shares_held_@PREV = 1 }
						subtract_from_variable = { currency_amount^primary_currency = Global.stock_price_@PREV }
						set_temp_variable = { increase_calc = stock_being_bought }
						divide_temp_variable = { increase_calc = Global.total_stocks_@PREV }
						add_to_temp_variable = { increase_calc = 1 }
						multiply_variable = { Global.stock_price_@PREV = increase_calc }
					}
				}
				if = {
					limit = {
						has_country_flag = buying_10_share
					}
					ROOT = {
						add_to_variable = { shares_held_@PREV = 10 }
						set_temp_variable = { stock_being_bought = Global.stock_price_@PREV}
						multiply_temp_variable = { stock_being_bought = 10 }
						subtract_from_variable = { currency_amount^primary_currency = stock_being_bought }
						set_temp_variable = { increase_calc = stock_being_bought }
						divide_temp_variable = { increase_calc = Global.total_stocks_@PREV }
						add_to_temp_variable = { increase_calc = 1 }
						multiply_variable = { Global.stock_price_@PREV = increase_calc }
					}
				}
				if = {
					limit = {
						has_country_flag = buying_50_share
					}
					ROOT = {
						add_to_variable = { shares_held_@PREV = 50 }
						set_temp_variable = { stock_being_bought = Global.stock_price_@PREV}
						multiply_temp_variable = { stock_being_bought = 50 }
						subtract_from_variable = { currency_amount^primary_currency = stock_being_bought }
						set_temp_variable = { increase_calc = stock_being_bought }
						divide_temp_variable = { increase_calc = Global.total_stocks_@PREV }
						add_to_temp_variable = { increase_calc = 1 }
						multiply_variable = { Global.stock_price_@PREV = increase_calc }
					}
				}
				ROOT = {
					set_variable = { share_percentage@PREV = shares_held_@PREV }
					divide_variable = { share_percentage@PREV = Global.total_stocks_@PREV }
					multiply_variable = { share_percentage@PREV = 100 }
				}
			}
			buyout_button_click = { 
				ROOT = {
					set_temp_variable = { stock_calc_buy = Global.total_stocks_@PREV }
					subtract_from_temp_variable = { stock_calc_buy = shares_held_@PREV }
					multiply_temp_variable = { stock_calc_buy = Global.stock_price_@PREV }
					subtract_from_variable = { currency_amount^primary_currency = stock_calc_buy }
					set_variable = { shares_held_@PREV = Global.total_stocks_@PREV }
					set_variable = { share_percentage@PREV = 100 }
				}
			}
		}
		triggers = {
			buy_button_click_enabled = {
				if = {
					limit = {
						OR = {
							has_country_flag = buying_50_share
							has_country_flag = buying_10_share
						}
					}
					ROOT = {
						check_variable = { currency_amount^primary_currency > stock_being_bought }
					}
				}
				else_if = {
					limit = {
						has_country_flag = buying_1_share
					}
					ROOT = {
						check_variable = { currency_amount^primary_currency > Global.stock_price_@PREV }
					}
				}
			}
			buy_1_button_click_enabled = {
				NOT = {
					has_country_flag = buying_1_share
				}
			}
			buy_2_button_click_enabled = {
				NOT = {
					has_country_flag = buying_10_share
				}
			}
			buy_3_button_click_enabled = {
				NOT = {
					has_country_flag = buying_50_share
				}
			}
			buyout_button_click_enabled = {
				ROOT = {
					check_variable = { share_percentage@PREV > 50 }
					set_temp_variable = { stock_calc = Global.total_stocks_@PREV }
					subtract_from_temp_variable = { stock_calc = shares_held_@PREV }
					multiply_temp_variable = { stock_calc = Global.stock_price_@PREV }
					check_variable = { currency_amount^primary_currency > stock_calc }
				}
			}
		}
		dynamic_lists = {
			stock_market_grid = {
				array = Global.stock_market_array
				entry_container = stock_entry
				change_scope = yes
			}
		}
		properties = {
			flag_producer = {
				image = "[This.GetFlag]"
			}
		}
	}
		stock_info_screen = {
			context_type = player_context
			window_name = "stock_info_screen"
			visible = {
				has_country_flag = stock_info_open
			}
			effects = {

		}
	}
}
scripted_gui = {
	operations_missions = {
		context_type = player_context
		window_name = "operations_missions"
		parent_window_name = countryintelligenceagencyview
		visible = {
            #has_country_flag = operations_open
			always = yes
		}
		triggers = {
			espionage_missions_1_initiate_click_enabled = {
				has_variable = espionage_mission_description_token_1
				NOT = {
					has_idea = espionage_mission_1_progress
				}
			}
			espionage_missions_2_initiate_click_enabled = {
				has_variable = espionage_mission_description_token_2
				NOT = {
					has_idea = espionage_mission_2_progress
				}
			}
            espionage_missions_3_initiate_click_enabled = {
				has_variable = espionage_mission_description_token_3
				NOT = {
					has_idea = espionage_mission_3_progress
				}
            }
		}
		effects = {
			espionage_mission_1_target_click = {
				var:targeted_country_slot_1 = {
					capital_scope = {
						ROOT = {
							goto_state = PREV
						}
					}
				}
			}
			espionage_mission_2_target_click = {
				var:targeted_country_slot_2 = {
					capital_scope = {
						ROOT = {
							goto_state = PREV
						}
					}
				}
			}
			espionage_mission_3_target_click = {
				var:targeted_country_slot_3 = {
					capital_scope = {
						ROOT = {
							goto_state = PREV
						}
					}
				}
			}
			espionage_missions_1_scrap_click = {
				scrap_espionage_mission_1 = yes
			}
			espionage_missions_2_scrap_click = {
				scrap_espionage_mission_2 = yes
			}
			espionage_missions_3_scrap_click = {
				scrap_espionage_mission_3 = yes
			}
			espionage_missions_1_initiate_click = {
				add_ideas = espionage_mission_1_progress
			}
			espionage_missions_2_initiate_click = {
				add_ideas = espionage_mission_2_progress
			}
			espionage_missions_3_initiate_click = {
				add_ideas = espionage_mission_3_progress
			}

			espionage_agent_recruitment_1 = {
				set_country_flag = agent_recruitment_screen_open
				set_variable = {what_espionage_slot = 1}
				create_temporary_agents = yes
			}
			espionage_agent_recruitment_2 = {
				set_country_flag = agent_recruitment_screen_open
				set_variable = {what_espionage_slot = 2}
				create_temporary_agents = yes
			}
			espionage_agent_recruitment_3 = {
				set_country_flag = agent_recruitment_screen_open
				set_variable = {what_espionage_slot = 3}
				create_temporary_agents = yes
			}
			espionage_agent_recruitment_4 = {
				set_country_flag = agent_recruitment_screen_open
				set_variable = {what_espionage_slot = 4}
				create_temporary_agents = yes
			}
			espionage_agent_recruitment_5 = {
				set_country_flag = agent_recruitment_screen_open
				set_variable = {what_espionage_slot = 5}
				create_temporary_agents = yes
			}
		}
		properties = {
			espionage_mission_1_target = {
				image = "[?targeted_country_slot_1.GetFlag]"
			}
			espionage_mission_2_target = {
				image = "[?targeted_country_slot_2.GetFlag]"
			}
			espionage_mission_3_target = {
				image = "[?targeted_country_slot_3.GetFlag]"
			}
			character_portrait_1 = {
				image = "[get_espionage_agent_portrait_1_main_key]"
			}
			character_portrait_2 = {
				image = "[get_espionage_agent_portrait_2_main_key]"
			}
			character_portrait_3 = {
				image = "[get_espionage_agent_portrait_3_main_key]"
			}
			mission_1_progress_bar = {
				frame = mission_1_progress_var
			}
			mission_2_progress_bar = {
				frame = mission_2_progress_var
			}
			mission_3_progress_bar = {
				frame = mission_3_progress_var
			}
		}
	}
	operation_mission_selection = {
		context_type = player_context
        parent_window_name = "operations_missions"
        window_name = "espionage_mission_selection"
		visible = {
            #has_country_flag = operations_open
			always = no
		}
		effects = {
			background_box_click = {
				if = {
					limit = {
						has_country_flag = operation_selection_slot_1
					}
					set_variable = {mission_identifier_1 = Espionage_mission_token_array^i}
				}else_if = {
					limit = {
						has_country_flag = operation_selection_slot_2
					}
					set_variable = {mission_identifier_2 = Espionage_mission_token_array^i}
				}else_if = {
					limit = {
						has_country_flag = operation_selection_slot_1
					}
					set_variable = {mission_identifier_3 = Espionage_mission_token_array^i}
				}else_if = {
					limit = {
						has_country_flag = operation_selection_slot_1
					}
					set_variable = {mission_identifier_4 = Espionage_mission_token_array^i}
				}else_if = {
					limit = {
						has_country_flag = operation_selection_slot_1
					}
					set_variable = {mission_identifier_5 = Espionage_mission_token_array^i}
				}
			}
		}

		dynamic_lists = {
            mission_gridbox = {
                array = global.Espionage_mission_token_array
                entry_container = espionage_mission_boxes
                change_scope = no
            }
        }
	}
	agent_recruitment_screen = {
		context_type = player_context
        parent_window_name = "operations_missions"
        window_name = "agent_recruitment_screen"
		visible = {
            has_country_flag = agent_recruitment_screen_open
		}
		select_agent_1 = {
			meta_effect = {
				text = {
					set_variable = { agent_identifier_slot_[WHAT_SLOT_IT_IS]  = agent_identifier_temporary_agent_1} 
					set_variable = { agent_portrait_slot_[WHAT_SLOT_IT_IS]  = agent_portrait_temporary_agent_1} 
					set_variable = { agent_name_slot_[WHAT_SLOT_IT_IS]  = agent_name_temporary_agent_1} 
					set_variable = { agent_charisma_slot_[WHAT_SLOT_IT_IS]  = agent_charisma_temporary_agent_1} 
					set_variable = { agent_intelligence_slot_[WHAT_SLOT_IT_IS]  = agent_intelligence_temporary_agent_1} 
					set_variable = { agent_martial_slot_[WHAT_SLOT_IT_IS]  = agent_martial_temporary_agent_1} 
					set_variable = { personality_trait_slot_[WHAT_SLOT_IT_IS]  = personality_trait_temporary_agent_1} 
					set_variable = { class_trait_slot_[WHAT_SLOT_IT_IS]  = class_trait_temporary_agent_1} 
					set_variable = { race_trait_slot_[WHAT_SLOT_IT_IS]  = race_trait_temporary_agent_1}
				}
				WHAT_SLOT_IT_IS = "[?what_espionage_slot]"
			}
		}
		select_agent_2 = {
			meta_effect = {
				text = {
					set_variable = { agent_identifier_slot_[WHAT_SLOT_IT_IS]  = agent_identifier_temporary_agent_2} 
					set_variable = { agent_portrait_slot_[WHAT_SLOT_IT_IS]  = agent_portrait_temporary_agent_2} 
					set_variable = { agent_name_slot_[WHAT_SLOT_IT_IS]  = agent_name_temporary_agent_2} 
					set_variable = { agent_charisma_slot_[WHAT_SLOT_IT_IS]  = agent_charisma_temporary_agent_2} 
					set_variable = { agent_intelligence_slot_[WHAT_SLOT_IT_IS]  = agent_intelligence_temporary_agent_2} 
					set_variable = { agent_martial_slot_[WHAT_SLOT_IT_IS]  = agent_martial_temporary_agent_2} 
					set_variable = { personality_trait_slot_[WHAT_SLOT_IT_IS]  = personality_trait_temporary_agent_2} 
					set_variable = { class_trait_slot_[WHAT_SLOT_IT_IS]  = class_trait_temporary_agent_2} 
					set_variable = { race_trait_slot_[WHAT_SLOT_IT_IS]  = race_trait_temporary_agent_2}
				}
				WHAT_SLOT_IT_IS = "[?what_espionage_slot]"
			}
		}
		select_agent_3 = {
			meta_effect = {
				text = {
					set_variable = { agent_identifier_slot_[WHAT_SLOT_IT_IS]  = agent_identifier_temporary_agent_3} 
					set_variable = { agent_portrait_slot_[WHAT_SLOT_IT_IS]  = agent_portrait_temporary_agent_3} 
					set_variable = { agent_name_slot_[WHAT_SLOT_IT_IS]  = agent_name_temporary_agent_3} 
					set_variable = { agent_charisma_slot_[WHAT_SLOT_IT_IS]  = agent_charisma_temporary_agent_3} 
					set_variable = { agent_intelligence_slot_[WHAT_SLOT_IT_IS]  = agent_intelligence_temporary_agent_3} 
					set_variable = { agent_martial_slot_[WHAT_SLOT_IT_IS]  = agent_martial_temporary_agent_3} 
					set_variable = { personality_trait_slot_[WHAT_SLOT_IT_IS]  = personality_trait_temporary_agent_3} 
					set_variable = { class_trait_slot_[WHAT_SLOT_IT_IS]  = class_trait_temporary_agent_3} 
					set_variable = { race_trait_slot_[WHAT_SLOT_IT_IS]  = race_trait_temporary_agent_3}
				}
				WHAT_SLOT_IT_IS = "[?what_espionage_slot]"
			}
		}
	}
}